function showToast(e,t="error"){let o=document.getElementById("toast-container");o||(o=document.createElement("div"),o.id="toast-container",document.body.appendChild(o));const s=document.createElement("div");s.className=`toast ${t}`,s.textContent=e,o.appendChild(s),setTimeout(()=>{s.classList.add("fade-out"),setTimeout(()=>s.remove(),500)},3e3)}async function startOTA(){const e=document.getElementById("ota-file"),t=document.querySelector('input[name="update-type"]:checked'),o=document.getElementById("ota-btn"),s=document.getElementById("ota-progress-bar"),n=document.getElementById("ota-percent"),a=document.getElementById("ota-progress-container");if(0===e.files.length)return void showToast("Please select a file first.");const d=e.files[0],i=t.value;if(!confirm(`Are you sure you want to flash this ${i} update? The device will reboot.`))return;o.disabled=!0,o.classList.add("loading"),a.style.display="block";const l=new XMLHttpRequest;l.open("POST","/api/ota?type="+("spiffs"===i?"spiffs":"app"),!0),l.upload.onprogress=e=>{if(e.lengthComputable){const t=Math.round(e.loaded/e.total*100);s.style.width=t+"%",n.textContent=t+"%"}},l.onload=()=>{o.classList.remove("loading"),200===l.status?(showToast("Update successful! Rebooting...","success"),s.style.width="100%",n.textContent="100%",setTimeout(()=>{window.location.href="/"},5e3)):(showToast("Update failed: "+l.responseText),o.disabled=!1)},l.onerror=()=>{showToast("Connection error during update."),o.disabled=!1,o.classList.remove("loading")},l.send(d)}